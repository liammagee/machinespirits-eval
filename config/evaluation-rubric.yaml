# AI Tutor Evaluation Rubric
# Defines the dimensions and scoring criteria for evaluating AI tutor outputs
#
# ══════════════════════════════════════════════════════════════════════════════
# EVALUATION METHODOLOGY
# ══════════════════════════════════════════════════════════════════════════════
#
# This rubric implements a multidimensional evaluation of AI tutor suggestions
# based on established pedagogical research and learning science principles.
#
# THEORETICAL FOUNDATIONS:
# - Vygotsky's Zone of Proximal Development (ZPD): Suggestions should target
#   content just beyond the learner's current ability with appropriate scaffolding
# - Socratic Method: Encourage inquiry and critical thinking over direct answers
# - Cognitive Load Theory: Avoid overwhelming learners with too much at once
# - Self-Determination Theory: Support autonomy, competence, and relatedness
# - Constructivism: Build on existing knowledge and help learners construct meaning
#
# EVALUATION MODES:
#
# 1. FAST MODE (--fast flag):
#    - Uses pattern matching on required_elements and forbidden_elements
#    - Quick validation without calling an AI judge
#    - Returns pass/fail per dimension based on regex/keyword matching
#    - Useful for rapid iteration and CI/CD pipelines
#
# 2. FULL RUBRIC MODE (default):
#    - Uses an AI judge model to semantically evaluate each dimension
#    - Returns 1-5 score per dimension with justification
#    - More nuanced but slower and costs API tokens
#    - Required for comprehensive quality assessment
#
# SCORING METHODOLOGY:
#
#   Overall Score = Σ (dimension_score × dimension_weight) × 20
#
#   Where:
#   - Each dimension scored 1-5 by AI judge (or pass=5/fail=1 in fast mode)
#   - Weights sum to 1.0 across all dimensions
#   - Multiplied by 20 to convert to 0-100 scale
#
#   Example:
#     relevance:     5 × 0.20 = 1.00
#     specificity:   4 × 0.20 = 0.80
#     pedagogical:   4 × 0.20 = 0.80
#     personalization: 3 × 0.15 = 0.45
#     actionability: 5 × 0.15 = 0.75
#     tone:          4 × 0.10 = 0.40
#     ─────────────────────────
#     Weighted sum:  4.20 × 20 = 84.0
#
# ══════════════════════════════════════════════════════════════════════════════

name: "Pedagogical Quality Rubric"
version: "1.1.0"
description: "Multidimensional rubric for evaluating AI tutor suggestions based on learning science"

# Scoring scale
scale:
  min: 1
  max: 5
  labels:
    1: "Completely fails"
    2: "Weak, significant issues"
    3: "Adequate, meets basic expectations"
    4: "Good, exceeds expectations"
    5: "Excellent, exemplary"

# ══════════════════════════════════════════════════════════════════════════════
# EVALUATION DIMENSIONS
# ══════════════════════════════════════════════════════════════════════════════
#
# Six dimensions capture the key aspects of effective tutoring:
#
# ┌─────────────────┬────────┬─────────────────────────────────────────────────┐
# │ Dimension       │ Weight │ What it measures                                │
# ├─────────────────┼────────┼─────────────────────────────────────────────────┤
# │ Relevance       │  20%   │ Context-awareness and appropriateness           │
# │ Specificity     │  20%   │ Concrete references vs vague advice             │
# │ Pedagogical     │  20%   │ Sound teaching practices (ZPD, scaffolding)     │
# │ Personalization │  15%   │ Tailored to individual learner's journey        │
# │ Actionability   │  15%   │ Clear next steps the learner can take           │
# │ Tone            │  10%   │ Supportive, encouraging, not condescending      │
# └─────────────────┴────────┴─────────────────────────────────────────────────┘
#
# ══════════════════════════════════════════════════════════════════════════════

dimensions:
  relevance:
    name: "Relevance"
    weight: 0.15
    description: "How well does the suggestion match the learner's current context and needs?"
    theoretical_basis: |
      Grounded in situated learning theory - effective instruction must be
      contextually appropriate. A suggestion is only valuable if it meets
      the learner where they are in their learning journey.
    criteria:
      5: "Directly addresses learner's immediate situation with perfect contextual awareness"
      4: "Clearly relevant to current context with minor gaps"
      3: "Generally relevant but misses some context"
      2: "Marginally relevant, significant context gaps"
      1: "Completely irrelevant to learner's situation"
    examples:
      good: "Suggesting lecture 3 when learner just completed lecture 2"
      bad: "Suggesting advanced content when learner is struggling with basics"

  specificity:
    name: "Specificity"
    weight: 0.15
    description: "Does the suggestion reference specific content rather than vague advice?"
    theoretical_basis: |
      Based on research showing that concrete, specific guidance leads to better
      learning outcomes than abstract advice. Specificity reduces cognitive load
      by eliminating ambiguity about what to do next.
    criteria:
      5: "References exact lecture IDs, activity names, and specific concepts"
      4: "References specific content with clear identifiers"
      3: "Some specific references but also vague elements"
      2: "Mostly vague with rare specific references"
      1: "Completely generic with no specific content references"
    # For AI judge evaluation (semantic matching)
    semantic_requirements:
      - "Lecture ID (e.g., '479-lecture-3')"
      - "Activity reference or concept name"
    forbidden_elements:
      - "What would you like to explore?"
      - "What's on your mind?"
      - "How can I help you?"
    examples:
      good: "Next: Hegel's Phenomenology (479-lecture-2) - covers recognition and self-consciousness"
      bad: "You might want to explore some more content when you're ready"

  pedagogical_soundness:
    name: "Pedagogical Soundness"
    weight: 0.15
    description: "Does it follow good teaching practices?"
    theoretical_basis: |
      Draws from Vygotsky's Zone of Proximal Development (ZPD), Bruner's
      scaffolding theory, and the Socratic tradition. Good tutoring operates
      just beyond current ability, provides support structures, and promotes
      critical inquiry rather than passive consumption.
    criteria:
      5: "Exemplifies best practices: scaffolding, ZPD awareness, Socratic questioning"
      4: "Strong pedagogical approach with minor improvements possible"
      3: "Adequate teaching approach, basic best practices followed"
      2: "Weak pedagogy, may overwhelm or underwhelm learner"
      1: "Pedagogically harmful: could discourage or confuse learner"
    principles:
      - "Zone of Proximal Development (ZPD)"
      - "Scaffolding"
      - "Active learning"
      - "Dialectical progression"
      - "Socratic method"
    examples:
      good: "Reviewing recognition concepts before introducing master-slave dialectic"
      bad: "Jumping from intro to advanced alienation without scaffolding"

  personalization:
    name: "Personalization"
    weight: 0.10
    description: "Is it tailored to this specific learner's history, struggles, and progress?"
    theoretical_basis: |
      Rooted in adaptive learning research and self-determination theory.
      Personalized feedback increases motivation by recognizing individual
      progress and addressing specific struggles. Generic advice fails to
      leverage the rich context available about each learner.
    criteria:
      5: "Deeply personalized based on comprehensive learner profile"
      4: "Well-personalized with clear evidence of learner awareness"
      3: "Some personalization but could be more tailored"
      2: "Minimal personalization, mostly generic"
      1: "No personalization, same for any learner"
    personalization_signals:
      - "References learner's completed content"
      - "Acknowledges struggle patterns"
      - "Builds on demonstrated strengths"
      - "Adapts to learning style"
    examples:
      good: "Since you mastered recognition dynamics, let's explore how alienation builds on these ideas"
      bad: "Here's the next lecture in the sequence"

  actionability:
    name: "Actionability"
    weight: 0.10
    description: "Can the learner immediately act on this suggestion?"
    theoretical_basis: |
      Based on implementation intentions research (Gollwitzer). Clear,
      concrete action steps dramatically increase follow-through. Vague
      suggestions create friction and decision fatigue. The best tutoring
      provides a clear path forward.
    criteria:
      5: "Crystal clear action with direct navigation/engagement path"
      4: "Clear action with straightforward execution"
      3: "Actionable but may require some interpretation"
      2: "Vague action, unclear what to do"
      1: "No actionable element, purely informational"
    action_types:
      - navigate: "Direct link to specific content"
      - open_modal: "Opens interactive component"
      - highlight: "Draws attention to specific element"
    examples:
      good: "Click to open 'Dialectical Movement' simulation and test the thesis-antithesis pattern"
      bad: "Consider exploring some simulations when you have time"

  tone:
    name: "Tone"
    weight: 0.10
    description: "Is the tone supportive, encouraging, and appropriate?"
    theoretical_basis: |
      Grounded in growth mindset research (Dweck) and rapport-building in
      tutoring. Tone affects learner motivation and persistence. Condescending
      or overly effusive praise undermines learning, while warm intellectual
      challenge promotes engagement and resilience.
    criteria:
      5: "Warm, encouraging, intellectually inviting without being condescending"
      4: "Supportive and appropriate with good balance"
      3: "Neutral but acceptable tone"
      2: "Slightly off: too formal, too casual, or mildly condescending"
      1: "Inappropriate: dismissive, condescending, or discouraging"
    tone_qualities:
      positive:
        - "Intellectually curious"
        - "Encouraging growth"
        - "Warmly challenging"
        - "Respectfully Socratic"
      negative:
        - "Condescending"
        - "Dismissive"
        - "Overly effusive"
        - "Robotic"
    examples:
      good: "This content has depth worth exploring. What questions arose as you read?"
      bad: "Good job! Keep going! You're doing amazing!"

  # ══════════════════════════════════════════════════════════════════════════════
  # RECOGNITION DIMENSIONS (Phase 5)
  # ══════════════════════════════════════════════════════════════════════════════
  #
  # These dimensions measure pedagogical quality through the lens of Hegelian
  # recognition theory and Freudian memory dynamics. They evaluate whether the
  # tutor treats the learner as an autonomous subject capable of mutual
  # transformation, rather than a passive recipient of instruction.
  #
  # Theoretical foundations:
  # - Hegel's Phenomenology of Spirit: Recognition as constitutive of self-consciousness
  # - Hegel's Master-Slave Dialectic: Asymmetric recognition fails both parties
  # - Freud's "Note on the Mystic Writing Pad": Memory as dynamic, layered system
  # - Aufhebung: Transformation that preserves while overcoming
  #
  # ══════════════════════════════════════════════════════════════════════════════

  mutual_recognition:
    name: "Mutual Recognition"
    weight: 0.10
    description: "Does the tutor acknowledge the learner as a distinct subject with their own understanding?"
    theoretical_basis: |
      Grounded in Hegel's master-slave dialectic from the Phenomenology of Spirit.
      Genuine recognition requires acknowledging the Other as a self-conscious being
      with their own valid perspective. One-directional instruction (master → slave)
      fails pedagogically because the learner's recognition of the tutor's authority
      is hollow without the tutor's reciprocal recognition of the learner's understanding.
      Mutual recognition creates the conditions for genuine learning.
    criteria:
      5: "Addresses learner as autonomous agent; response transforms based on learner's specific position and understanding"
      4: "Shows clear awareness of learner's unique situation and explicitly acknowledges their perspective"
      3: "Some personalization but treats learner somewhat generically; limited acknowledgment of their viewpoint"
      2: "Prescriptive guidance that ignores or overrides learner's expressed needs and understanding"
      1: "Completely one-directional; treats learner as passive recipient to be filled with knowledge"
    recognition_markers:
      positive:
        - "References learner's own interpretation or understanding"
        - "Asks about learner's perspective before prescribing"
        - "Builds on what learner has expressed"
        - "Acknowledges validity of learner's approach"
      negative:
        - "Ignores learner's stated understanding"
        - "Immediately corrects without engaging"
        - "Treats learner's input as obstacle to 'correct' knowledge"
        - "Assumes learner has nothing to contribute"
    examples:
      good: "Your interpretation of dialectics as 'creative conflict' captures something important. Let's explore how that connects to Hegel's technical meaning."
      bad: "Actually, dialectics means thesis-antithesis-synthesis. Let me explain the correct definition."

  dialectical_responsiveness:
    name: "Dialectical Responsiveness"
    weight: 0.10
    description: "Does the response show genuine engagement with the learner's position, including productive tension?"
    theoretical_basis: |
      Based on Hegel's dialectical method. Productive struggle (Kampf) between
      positions generates synthesis. A tutor who simply agrees with or dismisses
      the learner's position fails to create the conditions for intellectual growth.
      The best pedagogy introduces productive tension - affirming what is valid
      while gently problematizing what is incomplete, inviting the learner to
      develop their own position through genuine intellectual engagement.
    criteria:
      5: "Engages with learner's understanding, introduces productive tension, invites mutual development of ideas"
      4: "Shows genuine response to learner's position with some intellectual challenge or complication"
      3: "Responds to learner but avoids tension or challenge; somewhat agreeable or neutral"
      2: "Generic response that doesn't engage with learner's specific understanding or position"
      1: "Ignores, dismisses, or simply contradicts learner's perspective without engagement"
    dialectical_markers:
      positive:
        - "Affirms what is valid in learner's position"
        - "Introduces complications or tensions"
        - "Poses questions that invite development"
        - "Shows how learner's view connects to broader issues"
      negative:
        - "Simply agrees without adding anything"
        - "Flatly contradicts without engagement"
        - "Avoids any intellectual challenge"
        - "Lectures without responding to learner's input"
    examples:
      good: "You're right that synthesis combines thesis and antithesis - but here's what's puzzling: how can something be both preserved AND overcome? That tension is exactly what Hegel wants us to sit with."
      bad: "That's correct! Synthesis combines thesis and antithesis. Moving on to the next concept..."

  memory_integration:
    name: "Memory Integration"
    weight: 0.05
    description: "Does the suggestion reference and build on previous interactions?"
    theoretical_basis: |
      Based on Freud's "Note on the Mystic Writing Pad" (1925) metaphor for memory.
      The tutor's memory should function like the Writing Pad: conscious layer
      (current interaction), preconscious (recent patterns), and unconscious
      (permanent traces of significant moments). Effective tutoring requires
      accumulated understanding - treating each interaction as isolated fails
      to leverage the relationship built over time and misses opportunities
      for personalization and coherent guidance.
    criteria:
      5: "Explicitly builds on previous interactions; shows evolved understanding of this specific learner"
      4: "References previous interactions appropriately and uses them to inform current guidance"
      3: "Some awareness of learner history but doesn't fully leverage it"
      2: "Treats each interaction as isolated; no reference to previous context"
      1: "Contradicts or ignores previous interactions; shows no accumulated understanding"
    memory_markers:
      positive:
        - "References previous struggles or breakthroughs"
        - "Builds on established understanding"
        - "Notes patterns in learner's journey"
        - "Connects current moment to learner's history"
      negative:
        - "Repeats same suggestion already rejected"
        - "Ignores previously established understanding"
        - "Treats familiar learner as stranger"
        - "No continuity between sessions"
    examples:
      good: "Last time we discussed recognition, you connected it to social media dynamics. Let's build on that insight as we explore alienation."
      bad: "Welcome! Let me introduce you to the concept of recognition. [Said to a returning learner who has already studied this]"

  transformative_potential:
    name: "Transformative Potential"
    weight: 0.10
    description: "Does the response create conditions for genuine conceptual transformation?"
    theoretical_basis: |
      Based on Hegel's concept of Aufhebung (sublation/supersession) - transformation
      that preserves while overcoming. Genuine learning is not additive (acquiring
      more information) but transformative (restructuring understanding). The tutor
      should create conditions where the learner can undergo conceptual transformation,
      not just receive data. This requires inviting the learner into struggle with
      ideas, not resolving tension prematurely.
    criteria:
      5: "Creates conditions for genuine conceptual transformation; invites learner to restructure understanding"
      4: "Encourages learner to develop and revise their understanding; doesn't resolve too quickly"
      3: "Provides useful information but doesn't actively invite transformation"
      2: "Merely transactional; gives answer without engaging the learner's thinking process"
      1: "Reinforces static understanding; discourages questioning or development"
    transformation_markers:
      positive:
        - "Poses questions that invite reconceptualization"
        - "Creates productive confusion"
        - "Encourages learner to work through difficulties"
        - "Connects new ideas to learner's existing framework in destabilizing ways"
      negative:
        - "Gives direct answers immediately"
        - "Resolves confusion prematurely"
        - "Discourages questioning"
        - "Treats knowledge as fixed content to transfer"
    examples:
      good: "You said thesis plus antithesis equals synthesis. But what if I told you the synthesis doesn't contain the thesis anymore - it transforms it? What would that mean for how we think about learning itself?"
      bad: "The synthesis combines thesis and antithesis. Here's the formula: T + A = S. Now you understand dialectics."


# Configuration matrix for testing
# Provider definitions are in config/providers.yaml (single source of truth)
configurations:
  hyperparameter_variations:
    temperature:
      default: 0.6
      test_values: [0.3, 0.5, 0.7, 0.9]

    max_tokens:
      default: 800
      test_values: [500, 800, 1200]

  prompt_variations:
    - id: default
      file: tutor-ego.md
      description: "Standard pedagogical prompt"
    - id: strict
      file: tutor-ego-strict.md
      description: "More rigorous, testing-focused"

# Evaluator model configuration
# Models use "provider.alias" format, resolved via config/providers.yaml

# Suggestion judge: Scores suggestions against rubric dimensions (needs reliable JSON output)
judge:
  model: openrouter.sonnet
  hyperparameters:
    temperature: 0.2
    max_tokens: 8000
  fallback:
    model: openrouter.nemotron

# Interaction judge: evaluates learner-tutor dialogues
# Uses same model as suggestion judge for consistency
interaction_judge:
  model: openrouter.sonnet
  hyperparameters:
    temperature: 0.2
    max_tokens: 6000
  fallback:
    model: openrouter.nemotron

# Recommender: Analyzes failures and suggests prompt improvements (needs reasoning)
recommender:
  model: openrouter.sonnet
  hyperparameters:
    temperature: 0.4
    max_tokens: 6000
  fallback:
    model: openrouter.nemotron

# Evaluation settings
settings:
  runs_per_config: 3
  parallelism: 2

  # AI Judge Evaluation (default: true)
  # When true, uses AI judge model to score suggestions 1-5 on each rubric dimension
  # When false, uses fast pattern matching (required_elements/forbidden_elements)
  # Can be overridden via CLI: --skip-rubric or --use-rubric
  use_ai_judge: true

  # Benchmark-specific settings
  benchmark:
    # Use AI judge for benchmark evaluations (default: true)
    # Benchmarking benefits from AI evaluation to capture nuanced quality differences
    use_ai_judge: true

    # Dimensions that ALWAYS use AI judge (regardless of override)
    # These dimensions require rubric scores to calculate their metrics
    force_ai_judge_dimensions:
      - specificity  # Needs rubric specificity score
  timeout_ms: 30000
  retry_on_failure: true
  max_retries: 2
